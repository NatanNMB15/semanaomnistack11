steps:
  - name: gcr.io/cloud-builders/gsutil
    entrypoint: bash
    args:
      - "-c"
      - |
        gsutil cp gs://be-the-hero-275300.appspot.com/secrets/frontend/.env .env
        gsutil cp gs://be-the-hero-275300.appspot.com/secrets/frontend/.env.expressjs .env.expressjs
    timeout: "600s"
  - name: node:${_NODE_VERSION}
    entrypoint: bash
    args:
      - "-c"
      - |
        yarn install
        yarn run react-app-rewired build
    env:
      - "NODE_ENV=${_NODE_ENV}"
    timeout: "600s"
  - name: "gcr.io/cloud-builders/gcloud"
    args: ["app", "deploy", "client.yaml", "--no-promote"]
    timeout: "600s"
substitutions:
  _NODE_VERSION: "12"
  _NODE_ENV: "development"
